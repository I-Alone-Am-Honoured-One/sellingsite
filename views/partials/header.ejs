<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sellar Marketplace</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="site-loader" role="status" aria-live="polite" aria-label="Opening sequence">
    <div class="loader-core">
      <div class="loader-ring"></div>
      <div class="loader-radar"></div>
      <div class="loader-text">
        <span class="loader-title">Entering Sellar</span>
        <span class="loader-subtitle">Activate gamer marketplace</span>
      </div>
    </div>
  </div>
  <header class="site-header">
    <div class="container header-content">
      <div class="header-row-top">
        <a class="logo" href="/">Sellar</a>
        <% if (locals.currentUser) { %>
          <div class="profile-menu-mobile">
            <button class="profile-trigger-mobile" type="button" aria-label="Profile menu">
              <span class="avatar-mini">
                <% if (currentUser.avatar_url) { %>
                  <img src="<%= currentUser.avatar_url %>" alt="<%= currentUser.username %>" />
                <% } else { %>
                  <span><%= currentUser.username.slice(0, 1).toUpperCase() %></span>
                <% } %>
              </span>
            </button>
            <div class="profile-dropdown-mobile">
              <div class="dropdown-user-info">
                <span class="avatar-mini">
                  <% if (currentUser.avatar_url) { %>
                    <img src="<%= currentUser.avatar_url %>" alt="<%= currentUser.username %>" />
                  <% } else { %>
                    <span><%= currentUser.username.slice(0, 1).toUpperCase() %></span>
                  <% } %>
                </span>
                <div>
                  <div class="dropdown-username"><%= currentUser.username %></div>
                  <div class="dropdown-email"><%= currentUser.email %></div>
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <a href="/profile">Profile</a>
              <a href="/messages">Messages</a>
              <a href="/orders">Orders</a>
              <a href="/dashboard/insights">Dashboard</a>
              <a href="/favorites">Favorites</a>
              <% if (locals.isAdmin) { %>
                <a href="/dashboard">Admin dashboard</a>
              <% } %>
              <a href="/settings">Settings</a>
              <div class="dropdown-divider"></div>
              <form method="POST" action="/auth/logout">
                <button class="link-button danger" type="submit">Log out</button>
              </form>
            </div>
          </div>
        <% } %>
      </div>
      
      <nav class="nav-links">
        <a href="/" <% if (isActivePath('/')) { %>class="active"<% } %>>Home</a>
        <a href="/marketplace" <% if (isActivePath('/marketplace')) { %>class="active"<% } %>>Marketplace</a>
        <% if (locals.currentUser) { %>
          <a href="/listings/new" <% if (isActivePath('/listings/new')) { %>class="active"<% } %>>Create Listing</a>
          <a href="/messages" <% if (isActivePath('/messages')) { %>class="active"<% } %>>Messages</a>
          <a href="/dashboard/insights" <% if (isActivePath('/dashboard/insights')) { %>class="active"<% } %>>Dashboard</a>
          <a href="/favorites" <% if (isActivePath('/favorites')) { %>class="active"<% } %>>Favorites</a>
        <% } %>
      </nav>
      
      <% if (!locals.currentUser) { %>
        <div class="header-actions">
          <a class="header-link" href="/auth/sign-in">Sign in</a>
          <a class="button primary header-button" href="/auth/register">Register</a>
        </div>
      <% } else { %>
        <div class="header-actions-desktop">
          <div class="profile-menu">
            <button class="profile-trigger" type="button">
              <span class="avatar">
                <% if (currentUser.avatar_url) { %>
                  <img src="<%= currentUser.avatar_url %>" alt="<%= currentUser.username %> avatar" />
                <% } else { %>
                  <span><%= currentUser.username.slice(0, 1).toUpperCase() %></span>
                <% } %>
              </span>
              <span class="username"><%= currentUser.username %></span>
              <span class="caret">â–¾</span>
            </button>
            <div class="profile-dropdown">
              <a href="/profile">Profile</a>
              <a href="/messages">Messages</a>
              <a href="/orders">Orders</a>
              <a href="/dashboard/insights">Dashboard</a>
              <a href="/favorites">Favorites</a>
              <% if (locals.isAdmin) { %>
                <a href="/dashboard">Admin dashboard</a>
              <% } %>
              <a href="/settings">Settings</a>
              <form method="POST" action="/auth/logout">
                <button class="link-button" type="submit">Log out</button>
              </form>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  </header>
  <main class="main-content">
