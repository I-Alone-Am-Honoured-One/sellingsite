<%- include('../partials/header') %>
<section class="container section auth-layout">
  <div class="auth-sidebar">
    <p class="badge accent">Verify identity</p>
    <h1>Enter your reset code</h1>
    <p class="muted">Check your email for the 6-digit code we sent you.</p>
    <ul class="auth-benefits">
      <li>Codes expire after 15 minutes for safety.</li>
      <li>Choose a new password with at least 8 characters.</li>
      <li>Need a new code? Request another one anytime.</li>
    </ul>
    <div class="auth-support">
      <span class="muted">Need a new code?</span>
      <a class="link" href="/auth/forgot-password">Resend code</a>
    </div>
  </div>
  <div class="auth-panel">
    <div class="section-header">
      <div>
        <h2>Reset password</h2>
        <p class="muted">Verify the code and choose a new password.</p>
      </div>
    </div>

    <% if (error) { %>
      <div class="error"><%= error %></div>
    <% } %>
    <% if (success) { %>
      <div class="success"><%= success %></div>
    <% } %>
    <% if (locals.debugCode) { %>
      <div class="success" style="background: rgba(245, 158, 11, 0.15); border-color: rgba(245, 158, 11, 0.3); color: #fbbf24;">
        <strong>Development Mode:</strong> Email delivery is not configured. Use this code: <strong style="font-size: 1.25rem; font-family: 'Space Mono', monospace;"><%= debugCode %></strong>
      </div>
    <% } %>

    <form class="form-card" method="POST" action="/auth/reset-password">
      <label>
        Email address
        <input 
          type="email" 
          name="email" 
          value="<%= locals.email || '' %>" 
          placeholder="your@email.com"
          autocomplete="email"
          required 
        />
      </label>

      <label>
        6-digit reset code
        <input 
          type="text" 
          name="code" 
          inputmode="numeric" 
          pattern="[0-9]{6}" 
          placeholder="123456" 
          maxlength="6"
          autocomplete="one-time-code"
          style="font-family: 'Space Mono', monospace; font-size: 1.25rem; letter-spacing: 0.25rem; text-align: center;"
          required 
        />
      </label>

      <label>
        New password
        <input 
          type="password" 
          name="password" 
          placeholder="At least 8 characters"
          minlength="8"
          autocomplete="new-password"
          required 
        />
      </label>

      <label>
        Confirm new password
        <input 
          type="password" 
          name="confirmPassword" 
          placeholder="Re-enter your password"
          minlength="8"
          autocomplete="new-password"
          required 
        />
      </label>

      <button class="button primary" type="submit">Reset Password</button>
    </form>

    <div class="form-footer">
      <p>Didn't receive a code? <a href="/auth/forgot-password">Resend code</a></p>
      <p style="margin-top: 0.5rem;"><a href="/auth/sign-in">Back to sign in</a></p>
    </div>
  </div>
</section>
<%- include('../partials/footer') %>
