<%- include('../partials/header') %>
<section class="container section">
  <div class="section-header">
    <div>
      <h1>Your profile</h1>
      <p class="muted">Manage your account, avatar, and marketplace stats.</p>
    </div>
  </div>

  <% if (error) { %>
    <div class="error"><%= error %></div>
  <% } %>
  <% if (success) { %>
    <div class="success"><%= success %></div>
  <% } %>

  <div class="profile-grid">
    <div class="profile-card">
      <% const joinedDate = user.created_at ? new Date(user.created_at) : null; %>
      <div class="profile-identity">
        <div class="profile-avatar">
          <% if (user.avatar_url) { %>
            <img src="<%= user.avatar_url %>" alt="<%= user.username %> avatar" />
          <% } else { %>
            <span><%= user.username.slice(0, 1).toUpperCase() %></span>
          <% } %>
        </div>
        <div>
          <h2><%= user.username %></h2>
          <p class="muted"><%= user.email %></p>
          <p class="meta">
            Joined
            <%= joinedDate && !Number.isNaN(joinedDate.getTime()) ? joinedDate.toLocaleDateString() : 'â€”' %>
          </p>
        </div>
      </div>
      <p class="profile-bio"><%= user.bio || 'Add a short bio to help buyers get to know you.' %></p>
      <div class="stats-row">
        <div>
          <h3><%= listingCount %></h3>
          <p>Listings</p>
        </div>
        <div>
          <h3><%= orderCount %></h3>
          <p>Orders</p>
        </div>
      </div>
    </div>

    <div class="profile-card">
      <h3>Profile settings</h3>
      <p class="muted">Update your avatar, bio, and notification preferences in settings.</p>
      <div class="profile-actions">
        <a class="button primary" href="/settings">Go to settings</a>
      </div>
    </div>

    <div class="profile-card">
      <h3>Your listings</h3>
      <p class="muted">Keep your listings up to date and ready for buyers.</p>
      <% if (listings.length) { %>
        <div class="profile-listings">
          <% listings.forEach(listing => { %>
            <div class="profile-listing-card">
              <img src="<%= listing.image_url %>" alt="<%= listing.title %>" />
              <div class="profile-listing-details">
                <h4><%= listing.title %></h4>
                <p class="muted"><%= formatPrice(listing.price_cents) %></p>
                <p class="meta">Listed <%= new Date(listing.created_at).toLocaleDateString() %></p>
              </div>
              <div class="profile-listing-actions">
                <a class="button ghost small" href="/listings/<%= listing.id %>/edit">Edit</a>
              </div>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <div class="empty-state">
          <p>You do not have any listings yet.</p>
        </div>
      <% } %>
      <div class="settings-actions">
        <a class="button primary" href="/listings/new">Create new listing</a>
      </div>
    </div>
  </div>
</section>
<%- include('../partials/footer') %>
